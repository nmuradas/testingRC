<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Publicar Espacio | Renty Club</title>
    
    <link rel="stylesheet" href="assets/css/styles.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/config.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-bg text-brand antialiased">

    <nav class="fixed w-full z-50 top-0 bg-surface/95 backdrop-blur-md border-b border-border h-20 flex items-center">
        <div class="container mx-auto px-6 h-20 flex justify-between items-center max-w-7xl relative">
            <a href="index.html" class="flex items-center gap-2 group text-brand no-underline z-20">
                <div class="w-9 h-9 bg-brand text-white flex items-center justify-center font-serif text-xl italic rounded-lg">R</div>
                <span class="text-xl font-serif font-bold tracking-tight">Renty<span class="font-normal italic text-secondary">Club</span></span>
            </a>
            <div id="nav-right" class="flex items-center gap-6 text-sm font-medium z-20"></div>
        </div>
    </nav>

    <div class="min-h-screen flex items-center justify-center py-24 px-4">
        <div class="bg-surface p-8 rounded-2xl shadow-lg border border-border w-full max-w-2xl">
            <h1 class="text-2xl font-serif font-bold mb-2">Publicar nuevo espacio</h1>
            <p class="text-secondary text-sm mb-8">Completa la información para que los interesados te encuentren.</p>
            
            <form id="create-form" class="space-y-6">
                <div class="space-y-2">
                    <label class="block font-medium text-xs text-secondary uppercase tracking-wide">Título del anuncio</label>
                    <input id="title" class="w-full p-3 rounded-lg text-sm focus:outline-none focus:border-brand transition" placeholder="Ej: Local en Palermo Soho">
                </div>

                <div class="space-y-2">
                    <label class="block font-medium text-xs text-secondary uppercase tracking-wide">Descripción</label>
                    <textarea id="description" rows="3" class="w-full p-3 rounded-lg text-sm focus:outline-none focus:border-brand transition resize-none" placeholder="Contale a la gente sobre tu espacio..."></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="space-y-2">
                        <label class="block font-medium text-xs text-secondary uppercase tracking-wide">Precio por día ($)</label>
                        <input id="price" type="number" class="w-full p-3 rounded-lg text-sm focus:outline-none focus:border-brand transition">
                    </div>
                    <div class="space-y-2">
                        <label class="block font-medium text-xs text-secondary uppercase tracking-wide">Tamaño (m²)</label>
                        <input id="size" type="number" class="w-full p-3 rounded-lg text-sm focus:outline-none focus:border-brand transition" placeholder="Opcional">
                    </div>
                    <div class="space-y-2">
                        <label class="block font-medium text-xs text-secondary uppercase tracking-wide">Tipo</label>
                        <select id="type" class="w-full p-3 rounded-lg text-sm focus:outline-none focus:border-brand transition">
                            <option value="Local">Local Comercial</option>
                            <option value="Showroom">Showroom</option>
                            <option value="Oficina">Oficina</option>
                            <option value="Depósito">Depósito</option>
                            <option value="Evento">Evento</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="block font-medium text-xs text-secondary uppercase tracking-wide">Ubicación</label>
                    <div class="flex gap-2 mb-2">
                        <input id="address-input" class="w-full p-3 rounded-lg text-sm focus:outline-none focus:border-brand transition" placeholder="Ej: Av. Santa Fe 1234, CABA">
                        <button type="button" id="btn-search-map" class="bg-brand text-white px-4 py-2 rounded-lg text-xs font-bold hover:opacity-80 transition uppercase tracking-wide">Buscar</button>
                    </div>
                    
                    <div id="map"></div>
                    <input type="hidden" id="lat"><input type="hidden" id="lng">
                    <p class="text-[10px] text-secondary mt-1">Haz clic en el mapa para ajustar la posición exacta.</p>
                </div>

                <div class="space-y-2">
                    <label class="block font-medium text-xs text-secondary uppercase tracking-wide">URL de Imagen</label>
                    <input id="image" class="w-full p-3 rounded-lg text-sm focus:outline-none focus:border-brand transition" placeholder="https://...">
                </div>

                <div class="space-y-2">
                    <label class="block font-medium text-xs text-secondary uppercase tracking-wide">Amenities</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="amenities-container"></div>
                </div>

                <div class="pt-6 flex gap-4">
                    <a href="dashboard.html" class="flex-1 py-3 text-center text-sm font-bold text-secondary border border-border rounded-lg hover:bg-white/5 transition">Cancelar</a>
                    <button type="submit" class="flex-1 py-3 bg-brand text-white text-sm font-bold rounded-lg hover:opacity-90 shadow-lg transition">Publicar Espacio</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="bg-surface pt-20 pb-10 border-t border-border">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
            <div>
                <a href="index.html" class="flex items-center gap-2 mb-6">
                    <div class="w-8 h-8 bg-brand text-white flex items-center justify-center font-serif italic rounded">R</div>
                    <span class="font-bold text-xl">RentyClub</span>
                </a>
                <p class="text-secondary text-sm mb-6">La plataforma líder para alquiler de espacios temporales premium.</p>
                <div class="flex gap-4">
                    <a href="#" class="w-8 h-8 bg-white border border-border rounded-full flex items-center justify-center hover:border-black transition"><i class="fa-brands fa-instagram text-xs"></i></a>
                    <a href="#" class="w-8 h-8 bg-white border border-border rounded-full flex items-center justify-center hover:border-black transition"><i class="fa-brands fa-twitter text-xs"></i></a>
                    <a href="#" class="w-8 h-8 bg-white border border-border rounded-full flex items-center justify-center hover:border-black transition"><i class="fa-brands fa-linkedin-in text-xs"></i></a>
                </div>
            </div>
            
            <div>
                <h4 class="font-bold mb-6 text-sm uppercase tracking-wider">Compañía</h4>
                <ul class="space-y-4 text-sm text-secondary">
                    <li><a href="how-it-works.html" class="hover:text-brand">Cómo funciona</a></li>
                    <li><a href="pricing.html" class="hover:text-brand">Precios y Tarifas</a></li>
                </ul>
            </div>
            
            <div>
                <h4 class="font-bold mb-6 text-sm uppercase tracking-wider">Soporte</h4>
                <ul class="space-y-4 text-sm text-secondary">
                    <li><a href="help.html" class="hover:text-brand">Centro de ayuda</a></li>
                    <li><a href="trust.html" class="hover:text-brand">Confianza y Seguridad</a></li>
                    <li><a href="contact.html" class="hover:text-brand">Contacto / Soporte</a></li>
                </ul>
            </div>

            <div>
                <h4 class="font-bold mb-6 text-sm uppercase tracking-wider">Legal</h4>
                <ul class="space-y-4 text-sm text-secondary">
                    <li><a href="legal.html" class="hover:text-brand">Términos y Condiciones</a></li>
                    <li><a href="legal.html" class="hover:text-brand">Política de Privacidad</a></li>
                    <li><a href="legal.html" class="hover:text-brand">Cookies</a></li>
                </ul>
            </div>
        </div>
        
        <div class="max-w-7xl mx-auto px-4 pt-8 border-t border-border flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="text-xs text-secondary">© 2024 RentyClub Inc. Todos los derechos reservados.</p>
            <div class="flex gap-6 text-xs text-secondary font-bold">
                <span>ESPAÑOL (AR)</span>
                <span>$ ARS</span>
            </div>
        </div>
    </footer>

    <script src="assets/js/app.js"></script>
    <script>
        const AMENITIES_LIST = ["Seguridad 24hs", "Calefacción", "Baño privado", "Cocina", "Cochera", "Vidriera", "Aire Acondicionado", "WiFi"];
        let map, marker;

        document.addEventListener('DOMContentLoaded', async () => {
            const { data: { session } } = await db.auth.getSession();
            const navRight = document.getElementById('nav-right');
            if (session) navRight.innerHTML = `<a href="dashboard.html" class="text-brand font-bold text-xs uppercase mr-4">Mi Panel</a>`;
            else navRight.innerHTML = `<a href="login.html" class="text-secondary font-bold text-xs uppercase">Ingresar</a>`;

            const container = document.getElementById('amenities-container');
            AMENITIES_LIST.forEach(am => {
                container.innerHTML += `<label class="flex items-center gap-2 text-xs font-medium cursor-pointer text-secondary hover:text-brand transition"><input type="checkbox" value="${am}" class="accent-brand w-4 h-4 rounded border-border"> ${am}</label>`;
            });

            // MAPA ESTILO VOYAGER (Igual al Dashboard)
            try {
                map = L.map('map').setView([-34.6037, -58.3816], 13);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 20
                }).addTo(map);

                map.on('click', function(e) {
                    if (marker) map.removeLayer(marker);
                    marker = L.marker(e.latlng).addTo(map);
                    document.getElementById('lat').value = e.latlng.lat;
                    document.getElementById('lng').value = e.latlng.lng;
                });
            } catch (e) { console.error("Error mapa", e); }
        });

        document.getElementById('btn-search-map').addEventListener('click', async () => {
            const query = document.getElementById('address-input').value;
            if(!query) return;
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
            const data = await res.json();
            if (data && data.length > 0) {
                const lat = data[0].lat; const lon = data[0].lon;
                document.getElementById('lat').value = lat; document.getElementById('lng').value = lon;
                map.setView([lat, lon], 16);
                if (marker) map.removeLayer(marker);
                marker = L.marker([lat, lon]).addTo(map).bindPopup(query).openPopup();
            } else { alert("Dirección no encontrada."); }
        });

        document.getElementById('create-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const { data: { session } } = await db.auth.getSession();
            if (!session) { alert("Inicia sesión"); window.location.href='login.html'; return; }
            
            const newSpace = {
                owner_id: session.user.id,
                title: document.getElementById('title').value,
                type: document.getElementById('type').value,
                price: document.getElementById('price').value,
                size: document.getElementById('size').value || null,
                location: document.getElementById('address-input').value,
                lat: parseFloat(document.getElementById('lat').value) || null,
                lng: parseFloat(document.getElementById('lng').value) || null,
                image: document.getElementById('image').value,
                description: document.getElementById('description').value,
                amenities: Array.from(document.querySelectorAll('#amenities-container input:checked')).map(x => x.value)
            };

            if (!newSpace.title || !newSpace.price || !newSpace.location) return alert("Completa título, precio y ubicación.");

            const { error } = await db.from('spaces').insert(newSpace);
            if (error) alert("Error: " + error.message);
            else { alert("¡Publicado!"); window.location.href = 'dashboard.html'; }
        });
    </script>
</body>
</html>